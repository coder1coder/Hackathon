<layout-default title="Профиль" [isLoading]="isLoading">

  <div class="profile">

    <div class="profile__left">
      <profile-image [userId]="userId" [canUpload]="canUploadImage"></profile-image>
    </div>

    <div class="profile__right">

      <table *ngIf="user !== undefined">
        <tr>
          <td>Имя пользователя</td>
          <td [innerText]="user?.userName"></td>
        </tr>
        <tr>
          <td>Полное имя</td>
          <td [innerText]="user?.fullName"></td>
        </tr>
        <tr>
          <td class="email">E-mail</td>
          <td>
            <div>{{ user?.email?.address }}</div>
            <div *ngIf="(user?.email?.status ?? UserEmailStatus.NotConfirmed) == UserEmailStatus.NotConfirmed">
              <alert warn>Email не подтвержден. Для того, чтобы пользоваться всеми возможностями<br> системы необходимо <span class="email-confirmation-link" (click)="createEmailConfirmationRequest()">подтвердить</span> Email.</alert>
            </div>

            <div *ngIf="(user?.email?.status ?? UserEmailStatus.NotConfirmed) == UserEmailStatus.Pending">
              <alert>
                Код подтверждения отправлен на указанный Email. <br>
                <input #confirmationCodeInput>
                <br>
                <span class="email-confirmation-link" (click)="confirmEmail()">Подтвердить</span>
                <br><br>
                Если код не приходит, повторите попытку  через 5 минут или обратитесь в службу поддержки.
              </alert>
            </div>

            <div *ngIf="(user?.email?.status ?? UserEmailStatus.NotConfirmed) == UserEmailStatus.Confirmed">
              <alert>Email подтвержден</alert>
            </div>

          </td>
        </tr>
        <tr>
          <td>Роль</td>
          <td>{{ UserRoleTranslator.Translate(user.role) }}</td>
        </tr>
        <tr>
          <td>Команда</td>
          <td>{{ userTeam?.name ?? "Не состоит в команде" }}</td>
        </tr>
      </table>

      <div class="reaction__list" *ngIf="this.userId != this.authUserId">

        <div class="reaction reaction-{{ UserProfileReaction[reaction].toLowerCase() }}"
             (click)="toggleReaction($event, reaction)"
             [class.active]="isReactionActive(reaction)"
             *ngFor="let reaction of getAvailableUserProfileReactions()">

          <div [ngSwitch]="reaction">
            <mat-icon class="reaction-icon" *ngSwitchCase="UserProfileReaction.Like">thumb_up</mat-icon>
            <mat-icon class="reaction-icon" *ngSwitchCase="UserProfileReaction.Heart">favorite</mat-icon>
            <mat-icon class="reaction-icon" *ngSwitchCase="UserProfileReaction.Fire">local_fire_department</mat-icon>
          </div>

        </div>
      </div>

      <friendship-offer-button *ngIf="userId != authUserId" [friendId]="userId"></friendship-offer-button>

      <mat-tab-group *ngIf="this.userId == this.authUserId" [selectedIndex]="0" animationDuration="0">
        <mat-tab label="Друзья">
          <ng-template matTabContent>
            <friends-list [userId]="authUserId" [status]="FriendshipStatus.Confirmed"></friends-list>
          </ng-template>
        </mat-tab>
        <mat-tab label="Заявки в друзья">
          <ng-template matTabContent>
            <friends-list [userId]="authUserId" [status]="FriendshipStatus.Pending"></friends-list>
          </ng-template>
        </mat-tab>
      </mat-tab-group>

    </div>

  </div>

</layout-default>
